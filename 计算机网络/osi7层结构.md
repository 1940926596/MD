# OSI结构

## osi 开放式系统互联

OSI（开放式系统互联）模型是一个由国际标准化组织（ISO）制定的计算机网络通信标准，它将网络通信过程划分为七个不同的层次，分别是：

1. 物理层（Physical Layer）：负责传输比特流（0和1）的物理介质，例如电缆或无线电波。
2. 数据链路层（Data Link Layer）：负责将物理层的比特流组织成帧，并提供检错和纠错功能，例如以太网协议（Ethernet）。
3. 网络层（Network Layer）：负责将数据包从源节点传输到目标节点，例如IP协议。
4. 传输层（Transport Layer）：负责将数据从**一个应用程序传输到另一个应用程序**，例如TCP协议和UDP协议。
5. 会话层（Session Layer）：负责在通信节点之间建立、管理和终止会话连接。
6. 表示层（Presentation Layer）：负责将数据格式化为应用程序可以识别的格式，例如加密和压缩数据。
7. 应用层（Application Layer）：负责提供用户与网络之间的接口，例如HTTP协议和FTP协议。

OSI模型的七层结构提供了一种通用的网络通信标准，可以帮助不同厂商开发的设备之间实现互操作性，同时也为网络技术的学习和理解提供了一个框架。

**每个网络协议的报文格式**是不同的，但通常，上层协议的报文会包含下层协议所需要的信息。下面是每个层次的协议报文的一些通常包含的信息：

1. 物理层报文：物理层报文是比特流，没有额外的信息。
2. 数据链路层报文：数据链路层报文通常包括帧头和帧尾。帧头包含了目标和源地址、帧类型等信息，而帧尾通常包含了检错和纠错码。
3. 网络层报文：网络层报文通常包含IP数据报头，包括源IP地址、目标IP地址、TTL（生存时间）、协议类型等信息。
4. 传输层报文：传输层报文通常包含TCP头或UDP头。TCP头包含了源端口、目标端口、序列号、确认号、窗口大小等信息，而UDP头包含了源端口、目标端口和长度等信息。
5. 会话层报文：会话层报文包含建立、维护和终止会话连接所需要的信息，例如会话标识符。
6. 表示层报文：表示层报文包含了数据格式化所需要的信息，例如加密和压缩算法。
7. 应用层报文：应用层报文包含了应用程序所需要的信息，例如HTTP请求和响应头、FTP命令和数据等。

总的来说，每个协议层的报文都包含了下一层协议所需的信息，以便于网络通信的正常进行。

## 报文

### 网络层报文

网络层报文的长度是不确定的，因为它们必须能够容纳不同大小的数据包。IPv4协议定义的IP数据报长度可以从20字节到65,535字节不等，而IPv6协议定义的IP数据报长度最小为40字节，最大为65535字节。

一个典型的IPv4数据报头包含20个字节的固定部分和可变的选项部分。固定部分包含了版本、头长度、服务类型、总长度、标识符、标志、片偏移、TTL、协议类型、头校验和、源IP地址和目标IP地址等信息，这些信息总共占用20个字节。如果数据包中有选项字段，它们将会添加到这个固定的20字节头部之后，从而增加整个IP数据报的长度。

IPv6协议的数据报头部分比IPv4更加简洁，只包含了40个字节的固定部分，其中包括版本、流标签、有效载荷长度、下一个头、跳数限制、源IPv6地址和目标IPv6地址等信息。IPv6协议的选项部分通过扩展头来实现，这些扩展头的长度也是不固定的。

因此，网络层报文的长度取决于所使用的协议、传输的数据量和选项的使用。

### 传输层报文

传输层的报文长度也是不确定的，因为它们必须能够容纳不同大小的数据包。TCP和UDP是传输层中最常用的两种协议，它们的报文长度也有所不同。

TCP报文头部长度为20字节，其中包含源端口、目标端口、序列号、确认号、数据偏移量、保留字段、控制位、窗口大小、校验和和紧急指针等信息。在TCP报文头部之后，还可以有选项字段，根据选项的不同，TCP报文的长度可以达到最大约65,535个字节。

UDP报文头部长度为8个字节，其中包含源端口、目标端口、长度和校验和等信息。UDP没有选项字段，UDP报文的长度最大为65,535字节。

需要注意的是，由于网络传输时可能存在MTU（最大传输单元）的限制，因此实际上传输层报文的长度可能会根据不同的网络条件进行调整，以避免数据包被分片，从而降低传输效率。

### MTU

MTU（Maximum Transmission Unit，最大传输单元）是指在数据链路层上可以传输的最大数据包长度。数据链路层负责在物理层上实现数据的传输，将网络层的数据包封装成帧并在物理介质上进行传输。因此，MTU大小是由数据链路层的物理介质和协议规定的，不同类型的物理介质和协议都有不同的MTU大小限制。例如，以太网的MTU通常为1500字节，而一些高速网络的MTU则可能更大。当数据包长度大于网络的MTU时，需要进行分片处理，将一个大的数据包分割成多个小的数据包进行传输，以确保数据的可靠传输。

是的，当一个网络层报文的长度超过了网络的MTU（Maximum Transmission Unit，最大传输单元）时，网络层需要将该报文进行分片处理，将一个大的报文分割成多个小的报文进行传输，以确保数据的可靠传输。

#### MTU将网络层的报文进行分片

在进行分片处理时，网络层会将原始报文进行分割，生成多个IP分片。每个IP分片都是一个独立的数据包，包含IP头部和分片的数据部分。IP头部中有一个字段表示该分片在整个IP数据报中的偏移量，以及一个标志位表示该分片是否为最后一个分片。在接收端，网络层会根据分片头部中的信息将分片进行重组，得到原始的网络层报文，然后再交给上层进行处理。

需要注意的是，分片处理可能会带来一定的开销和延迟，因为每个分片都需要附加一个IP头部，增加了网络传输的负载。因此，在网络设计和配置中应该尽量避免进行分片处理，以提高网络传输效率和质量。

### 如果传输层的报文长度超过了网络层报文内容限制

传输层的报文长度是由应用层的数据长度决定的，而网络层的报文长度是由网络协议和物理介质决定的。如果传输层的报文长度超过了网络层的报文长度限制，那么需要将传输层的报文进行分片处理，将一个大的报文分割成多个小的报文进行传输，以确保数据的可靠传输。

在进行分片处理时，需要在IP层对报文进行分割，生成多个IP分片。每个IP分片都是一个独立的数据包，包含IP头部和分片的数据部分。IP头部中有一个字段表示该分片在整个IP数据报中的偏移量，以及一个标志位表示该分片是否为最后一个分片。在接收端，IP层会根据分片头部中的信息将分片进行重组，得到原始的传输层报文，然后再交给传输层进行处理。

需要注意的是，分片处理可能会带来一定的开销和延迟，因为每个分片都需要附加一个IP头部，增加了网络传输的负载。因此，应该尽量避免传输层报文长度超过网络层报文长度限制的情况的发生，以提高网络传输效率和质量。

## 传输单元类型

传输单元：

1. 应用层：报文
2. 传输层：报文段
3. 网络层：IP数据报，分组
4. 链路层：帧
5. 物理层：bit流